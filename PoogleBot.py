import requests, os, sys, time
from random import randint

class PRE(object):
    def __init__(self):
        self.s=requests.session()
        self.base = 'http://www.neopets.com/'

    def login(self, username, password):
        url = self.base + 'login.phtml'
        self.s.headers.update({'Content-Type':'application/x-www-form-urlencoded','User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','Referer':'http://www.neopets.com/index.phtml','Accept-Encoding':'gzip, deflate','Accept-Language':'en-US,en;q=0.9'})
        data = {'username':username,'password':password,'destination':'/index.phtml'}
        r = self.s.post(url, data=data)
        if 'index' in r.url:
            print('Logged in.')
        elif 'badpassword' in r.text:
            print('Wrong Password')
        elif 'FROZEN' in r.text:
            print('Account Frozen.')

    def pooglerace(self):
        url = self.base + 'faerieland/poogleracing.phtml'
        self.s.headers.update({'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','Referer': 'http://www.jellyneo.net/?go=dailies', 'Accept-Encoding': 'gzip, deflate','Accept-Language': 'en-US,en;q=0.9'})
        self.s.get(url)
        url = self.base + 'faerieland/poogleracing/start.phtml'
        r = self.s.get(url)
        win1 = r.text.find("prediction=") + len("prediction=")
        win2 = r.text.find("&prediction=", win1)
        winner = r.text[win1:win2]
        print('The winning poogle this round is: ' + winner)
        self.s.headers.update({'Content-Type':'application/x-www-form-urlencoded','User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','Referer': 'http://www.neopets.com/faerieland/pooglebetting.phtml', 'Accept-Encoding': 'gzip, deflate','Accept-Language': 'en-US,en;q=0.9'})
        url = self.base + 'faerieland/pooglebetting.phtml'
        self.s.post(url)
        url = self.base + 'faerieland/process_pooglebetting.phtml'
        bet = {'poogle':winner,'bet':'300','obj_info_id':'0'}
        r = self.s.post(url,data=bet)
        if 'thanks' in r.url:
            print('Placed a 300NP bet on poogle #'+winner)
        else:
            print('Failed to place a bet.')
        self.s.headers.update({'Content-Type': 'application/x-www-form-urlencoded','User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','Referer': 'http://www.neopets.com/faerieland/pooglebetting.phtml?type=thanks','Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'en-US,en;q=0.9'})
        url = self.base + 'faerieland/poogleracing.phtml'
        self.s.post(url)
        print('waiting 1 minute..')
        time.sleep(60)
        self.s.headers.update({'Content-Type': 'application/x-www-form-urlencoded','User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','Referer': 'http://www.neopets.com/faerieland/poogleracing.phtml','Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'en-US,en;q=0.9'})
        url = self.base + 'faerieland/poogleracing.phtml?type=viewrace'
        data = {'rand':randint(1,999),'subbysound':'Click to View Race'}
        self.s.post(url,data=data)
        self.s.headers.update({'Content-Type': 'application/x-www-form-urlencoded','User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','Referer': 'http://www.neopets.com/faerieland/poogleracing.phtml?type=viewrace','Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'en-US,en;q=0.9'})
        url = self.base + 'faerieland/poogleracing.phtml'
        winnings = {'type':'collect'}
        self.s.post(url,data=winnings)
        print('Finished poogle race.')
        print('waiting 14 minutes..')
        time.sleep(840)

    def exploit(self):
        self.login('Username Here','Password Here')
        self.pooglerace()


if __name__ == '__main__':
    num = int(input('How many times do you want to exploit poogle race?\n--> '))
    for i in range(num):
        a=PRE()
        a.exploit()
